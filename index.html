<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VibeCurate ‚Äî AI-Powered Playlist Curation | dubltap.io</title>
  <meta name="description" content="Tell us the mood. We'll find the music. AI-powered playlist curation that understands your vibe. Free unlimited playlists.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="VibeCurate | AI-Powered Playlist Curation">
  <meta property="og:description" content="Tell us the mood. We'll find the music. Free unlimited AI-curated playlists.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://vibe.dubltap.io">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="VibeCurate | AI-Powered Playlist Curation">
  <meta name="twitter:description" content="Tell us the mood. We'll find the music. Free unlimited AI-curated playlists.">
  
  <meta name="theme-color" content="#264653">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       VIBECURATE ‚Äî DESIGN SYSTEM
       dubltap.io Bridge Product | Golden Ratio (œÜ = 1.618)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    :root {
      /* SoCal Sunset */
      --sunset-gold: #F4A261;
      --sunset-coral: #E76F51;
      --sunset-peach: #FFBE98;
      
      /* Ocean */
      --ocean-deep: #264653;
      --ocean-teal: #2A9D8F;
      --ocean-foam: #A8DADC;
      
      /* Sand */
      --sand-light: #FDF8F3;
      --sand-warm: #E9E0D6;
      --sand-medium: #C4B7A6;
      --sand-dark: #4A4238;
      
      /* VibeCurate Accent */
      --purple-vibe: #7C3AED;
      --purple-light: #A78BFA;
      --purple-glow: rgba(124, 58, 237, 0.15);
      
      /* Golden Ratio Spacing */
      --phi-xs: 0.382rem;
      --phi-sm: 0.618rem;
      --phi-md: 1rem;
      --phi-lg: 1.618rem;
      --phi-xl: 2.618rem;
      --phi-2xl: 4.236rem;
      --phi-3xl: 6.854rem;
      
      /* Typography */
      --font-display: 'Outfit', system-ui, sans-serif;
      --font-body: 'DM Sans', system-ui, sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: var(--font-body);
      background: var(--sand-light);
      color: var(--sand-dark);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* ‚ïê‚ïê‚ïê Ambient Background ‚ïê‚ïê‚ïê */
    .bg-ambient {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background: 
        radial-gradient(ellipse 80% 50% at 20% 40%, rgba(124, 58, 237, 0.06) 0%, transparent 70%),
        radial-gradient(ellipse 60% 60% at 80% 20%, rgba(244, 162, 97, 0.08) 0%, transparent 60%),
        radial-gradient(ellipse 50% 40% at 50% 90%, rgba(42, 157, 143, 0.05) 0%, transparent 50%);
    }
    
    .bg-ambient::after {
      content: '';
      position: absolute;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
      opacity: 0.4;
    }
    
    /* ‚ïê‚ïê‚ïê Header ‚ïê‚ïê‚ïê */
    .header {
      position: sticky;
      top: 0;
      z-index: 40;
      background: rgba(253, 248, 243, 0.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(196, 183, 166, 0.3);
    }
    
    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: var(--phi-sm) var(--phi-lg);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: var(--phi-sm);
      cursor: pointer;
    }
    
    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
    }
    
    .logo-text {
      font-family: var(--font-display);
      font-weight: 800;
      font-size: 1.25rem;
      color: var(--ocean-deep);
      letter-spacing: -0.02em;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--phi-sm);
    }
    
    .header-stat {
      display: none;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 20px;
      background: rgba(255,255,255,0.8);
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--sand-dark);
    }
    
    .header-stat svg { color: var(--ocean-teal); }
    
    @media (min-width: 640px) {
      .header-stat { display: flex; }
    }
    
    /* ‚ïê‚ïê‚ïê Buttons ‚ïê‚ïê‚ïê */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: 25px;
      font-family: var(--font-body);
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--sand-dark);
    }
    .btn-ghost:hover {
      background: var(--sand-warm);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--sunset-gold), var(--sunset-coral));
      color: white;
      box-shadow: 0 2px 10px rgba(244, 162, 97, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(244, 162, 97, 0.4);
    }
    
    .btn-vibe {
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral));
      color: white;
      box-shadow: 0 2px 12px rgba(124, 58, 237, 0.3);
    }
    .btn-vibe:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 18px rgba(124, 58, 237, 0.4);
    }
    
    .btn-outline {
      background: transparent;
      color: var(--ocean-deep);
      border: 1.5px solid var(--ocean-foam);
    }
    .btn-outline:hover {
      background: var(--sand-warm);
      border-color: var(--ocean-teal);
    }
    
    .btn-lg {
      padding: 12px 28px;
      font-size: 0.95rem;
    }
    
    .pro-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 14px;
      border-radius: 20px;
      background: var(--ocean-deep);
      color: var(--sunset-gold);
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.82rem;
    }
    
    /* ‚ïê‚ïê‚ïê Main Content ‚ïê‚ïê‚ïê */
    .main {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: var(--phi-xl) var(--phi-lg) var(--phi-3xl);
    }
    
    /* ‚ïê‚ïê‚ïê Hero ‚ïê‚ïê‚ïê */
    .hero {
      text-align: center;
      margin-bottom: var(--phi-2xl);
      animation: fadeUp 0.6s ease-out;
    }
    
    .hero-icon {
      font-size: 3.5rem;
      margin-bottom: var(--phi-md);
      animation: float 3s ease-in-out infinite;
    }
    
    .hero h1 {
      font-family: var(--font-display);
      font-weight: 900;
      font-size: clamp(2.4rem, 6vw, 4rem);
      line-height: 1.05;
      color: var(--ocean-deep);
      margin-bottom: var(--phi-sm);
    }
    
    .hero h1 span {
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral), var(--sunset-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero p {
      font-size: 1.2rem;
      color: var(--sand-dark);
      margin-bottom: var(--phi-lg);
    }
    
    .free-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: 20px;
      background: rgba(42, 157, 143, 0.08);
      border: 1px solid var(--ocean-teal);
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--ocean-teal);
    }
    
    /* ‚ïê‚ïê‚ïê Usage Indicator ‚ïê‚ïê‚ïê */
    .usage-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--phi-sm);
      margin-bottom: var(--phi-lg);
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .usage-track {
      width: 100px;
      height: 6px;
      background: var(--sand-warm);
      border-radius: 3px;
      overflow: hidden;
    }
    
    .usage-fill {
      height: 100%;
      border-radius: 3px;
      background: var(--ocean-teal);
      transition: width 0.4s ease, background 0.3s ease;
    }
    
    .usage-fill.low { background: var(--sunset-coral); }
    
    .usage-text { color: var(--sand-dark); }
    .usage-text.low { color: var(--sunset-coral); }
    
    /* ‚ïê‚ïê‚ïê Quick Prompts ‚ïê‚ïê‚ïê */
    .quick-section {
      text-align: center;
      margin-bottom: var(--phi-lg);
    }
    
    .quick-label {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--sand-medium);
      margin-bottom: var(--phi-sm);
    }
    
    .quick-prompts {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }
    
    .quick-prompt {
      padding: 7px 16px;
      border-radius: 20px;
      border: 1px solid var(--ocean-foam);
      background: rgba(255,255,255,0.7);
      font-family: var(--font-body);
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--sand-dark);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .quick-prompt:hover {
      background: var(--purple-glow);
      border-color: var(--purple-light);
      color: var(--purple-vibe);
      transform: translateY(-1px);
    }
    
    /* ‚ïê‚ïê‚ïê Input Section ‚ïê‚ïê‚ïê */
    .input-section {
      margin-bottom: var(--phi-xl);
    }
    
    .input-container {
      display: flex;
      gap: var(--phi-sm);
      max-width: 640px;
      margin: 0 auto;
    }
    
    .vibe-input {
      flex: 1;
      padding: 14px 20px;
      border-radius: 16px;
      border: 2px solid var(--ocean-foam);
      background: white;
      font-family: var(--font-body);
      font-size: 1rem;
      color: var(--sand-dark);
      outline: none;
      transition: border-color 0.2s ease;
    }
    
    .vibe-input:focus {
      border-color: var(--purple-vibe);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    .vibe-input::placeholder {
      color: var(--sand-medium);
    }
    
    .generate-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 14px 24px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral));
      color: white;
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      box-shadow: 0 3px 15px rgba(124, 58, 237, 0.3);
    }
    
    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(124, 58, 237, 0.4);
    }
    
    .generate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* ‚ïê‚ïê‚ïê Loading ‚ïê‚ïê‚ïê */
    .loading-state {
      text-align: center;
      padding: var(--phi-2xl) var(--phi-lg);
      display: none;
    }
    
    .loading-state.active { display: block; }
    
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--sand-warm);
      border-top-color: var(--purple-vibe);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto var(--phi-md);
    }
    
    .loading-text {
      font-weight: 500;
      color: var(--sand-dark);
    }
    
    .loading-sub {
      font-size: 0.85rem;
      color: var(--sand-medium);
      margin-top: 4px;
    }
    
    /* ‚ïê‚ïê‚ïê Playlist Results ‚ïê‚ïê‚ïê */
    .playlist-container {
      display: none;
    }
    
    .playlist-container.active { display: block; }
    
    .playlist-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--phi-lg);
      flex-wrap: wrap;
      gap: var(--phi-sm);
    }
    
    .playlist-title {
      font-family: var(--font-display);
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--ocean-deep);
    }
    
    .playlist-mood {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--purple-vibe);
      padding: 4px 12px;
      background: var(--purple-glow);
      border-radius: 12px;
    }
    
    .playlist-actions {
      display: flex;
      gap: 8px;
    }
    
    .song-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: var(--phi-xl);
    }
    
    .song-card {
      display: flex;
      align-items: center;
      gap: var(--phi-md);
      padding: var(--phi-md);
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(196, 183, 166, 0.25);
      border-radius: 14px;
      transition: all 0.2s ease;
      animation: fadeUp 0.4s ease-out both;
    }
    
    .song-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      border-color: var(--purple-light);
    }
    
    .song-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--purple-glow);
      color: var(--purple-vibe);
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .song-info {
      flex: 1;
      min-width: 0;
    }
    
    .song-title {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--ocean-deep);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .song-artist {
      font-size: 0.82rem;
      color: var(--sand-dark);
      margin-top: 1px;
    }
    
    .song-why {
      font-size: 0.78rem;
      color: var(--sand-medium);
      font-style: italic;
      margin-top: 2px;
    }
    
    .song-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }
    
    .song-btn {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: 1px solid var(--ocean-foam);
      background: white;
      color: var(--sand-dark);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 0.85rem;
    }
    
    .song-btn:hover {
      background: var(--purple-glow);
      border-color: var(--purple-light);
      color: var(--purple-vibe);
    }
    
    /* ‚ïê‚ïê‚ïê Cross-Sell Banner ‚ïê‚ïê‚ïê */
    .cross-sell {
      background: linear-gradient(135deg, rgba(42, 157, 143, 0.08), rgba(244, 162, 97, 0.08));
      border: 1px solid rgba(42, 157, 143, 0.2);
      border-radius: 16px;
      padding: var(--phi-lg);
      text-align: center;
      margin-top: var(--phi-xl);
    }
    
    .cross-sell h3 {
      font-family: var(--font-display);
      font-weight: 700;
      color: var(--ocean-deep);
      margin-bottom: var(--phi-xs);
    }
    
    .cross-sell p {
      font-size: 0.9rem;
      color: var(--sand-dark);
      margin-bottom: var(--phi-md);
    }
    
    /* ‚ïê‚ïê‚ïê History Section ‚ïê‚ïê‚ïê */
    .history-section {
      display: none;
    }
    
    .history-section.active { display: block; }
    
    .history-title {
      font-family: var(--font-display);
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--ocean-deep);
      margin-bottom: var(--phi-lg);
    }
    
    .history-empty {
      text-align: center;
      padding: var(--phi-2xl);
      color: var(--sand-medium);
    }
    
    .history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--phi-md);
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(196, 183, 166, 0.25);
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .history-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .history-item-info h4 {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--ocean-deep);
    }
    
    .history-item-info p {
      font-size: 0.78rem;
      color: var(--sand-medium);
      margin-top: 2px;
    }
    
    .history-item-count {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.82rem;
      color: var(--purple-vibe);
    }
    
    /* ‚ïê‚ïê‚ïê Modals ‚ïê‚ïê‚ïê */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(38, 70, 83, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      padding: var(--phi-lg);
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: var(--sand-light);
      border-radius: 24px;
      padding: var(--phi-xl);
      max-width: 440px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      position: relative;
      animation: scaleIn 0.3s ease-out;
    }
    
    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: var(--sand-warm);
      color: var(--sand-dark);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      transition: background 0.2s;
    }
    
    .modal-close:hover { background: var(--sand-medium); }
    
    .modal-icon {
      font-size: 2.5rem;
      margin-bottom: var(--phi-sm);
    }
    
    .modal h2 {
      font-family: var(--font-display);
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--ocean-deep);
      margin-bottom: var(--phi-xs);
    }
    
    .modal p {
      color: var(--sand-dark);
      font-size: 0.92rem;
      margin-bottom: var(--phi-lg);
      line-height: 1.5;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px 18px;
      border-radius: 12px;
      border: 2px solid var(--ocean-foam);
      background: white;
      font-family: var(--font-body);
      font-size: 0.95rem;
      color: var(--sand-dark);
      outline: none;
      margin-bottom: var(--phi-sm);
      transition: border-color 0.2s;
    }
    
    .modal-input:focus {
      border-color: var(--ocean-teal);
      box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.1);
    }
    
    .modal-submit {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      background: var(--sunset-gold);
      color: var(--ocean-deep);
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .modal-submit:hover {
      background: var(--sunset-coral);
      color: white;
      transform: translateY(-1px);
    }
    
    .modal-dismiss {
      display: block;
      width: 100%;
      text-align: center;
      margin-top: var(--phi-sm);
      font-size: 0.82rem;
      color: var(--sand-medium);
      background: none;
      border: none;
      cursor: pointer;
    }
    
    .modal-dismiss:hover { color: var(--sand-dark); }
    
    .modal-fine-print {
      text-align: center;
      font-size: 0.75rem;
      color: var(--sand-medium);
      margin-top: var(--phi-md);
    }
    
    .modal-error {
      color: var(--sunset-coral);
      font-size: 0.82rem;
      margin-bottom: var(--phi-sm);
      display: none;
    }
    
    /* ‚ïê‚ïê‚ïê Upgrade Modal ‚ïê‚ïê‚ïê */
    .pricing-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--phi-sm);
      margin-bottom: var(--phi-md);
    }
    
    .pricing-card {
      padding: var(--phi-md);
      border-radius: 14px;
      border: 2px solid var(--ocean-foam);
      background: white;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .pricing-card:hover, .pricing-card.selected {
      border-color: var(--purple-vibe);
      box-shadow: 0 4px 16px rgba(124, 58, 237, 0.15);
    }
    
    .pricing-card.recommended::before {
      content: 'Best Value';
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 2px 12px;
      background: var(--ocean-teal);
      color: white;
      font-size: 0.68rem;
      font-weight: 700;
      border-radius: 6px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .pricing-name {
      font-weight: 700;
      color: var(--ocean-deep);
      margin-bottom: 4px;
      font-size: 0.88rem;
    }
    
    .pricing-price {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--purple-vibe);
    }
    
    .pricing-price span {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--sand-dark);
    }
    
    .pricing-savings {
      font-size: 0.75rem;
      color: var(--ocean-teal);
      font-weight: 600;
      margin-top: 2px;
    }
    
    .upgrade-features {
      list-style: none;
      margin-bottom: var(--phi-lg);
    }
    
    .upgrade-features li {
      padding: 5px 0;
      font-size: 0.88rem;
      color: var(--sand-dark);
    }
    
    .upgrade-features li::before {
      content: '‚úì ';
      color: var(--ocean-teal);
      font-weight: 700;
    }
    
    /* ‚ïê‚ïê‚ïê Footer ‚ïê‚ïê‚ïê */
    .footer {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: var(--phi-xl) var(--phi-lg);
      font-size: 0.82rem;
      color: var(--sand-medium);
    }
    
    .footer a {
      color: var(--ocean-teal);
      text-decoration: none;
      font-weight: 500;
    }
    
    .footer a:hover { text-decoration: underline; }
    
    /* ‚ïê‚ïê‚ïê Animations ‚ïê‚ïê‚ïê */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.92); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    .hidden { display: none !important; }
    
    /* ‚ïê‚ïê‚ïê Responsive ‚ïê‚ïê‚ïê */
    @media (max-width: 640px) {
      .input-container {
        flex-direction: column;
      }
      
      .hero h1 {
        font-size: 2.2rem;
      }
      
      .song-card {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--phi-sm);
      }
      
      .song-actions {
        align-self: flex-end;
      }
      
      .pricing-options {
        grid-template-columns: 1fr;
      }
      
      .header-actions .btn span {
        display: none;
      }
    }

    /* ‚ïê‚ïê‚ïê Sticky Player Bar ‚ïê‚ïê‚ïê */
    .player-bar {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background: linear-gradient(135deg, #1a2f38 0%, #264653 50%, #1a3040 100%);
      box-shadow: 0 -4px 24px rgba(0,0,0,0.3);
      padding: 0;
      color: #fff;
    }
    .player-bar.active { display: block; }

    .player-progress {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255,0.12);
      cursor: pointer;
      position: relative;
    }
    .player-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--purple-vibe), var(--sunset-gold));
      border-radius: 0 2px 2px 0;
      width: 0%;
      transition: width 0.3s linear;
    }

    .player-inner {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .player-art {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      background: rgba(255,255,255,0.08);
      flex-shrink: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .player-art img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .player-art-placeholder {
      font-size: 1.4rem;
      opacity: 0.5;
    }
    .player-art .vinyl-spin {
      animation: spin 3s linear infinite;
    }

    .player-track {
      flex: 1;
      min-width: 0;
    }
    .player-track-title {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .player-track-artist {
      font-size: 0.78rem;
      color: rgba(255,255,255,0.55);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .player-track-status {
      font-size: 0.7rem;
      color: var(--sunset-gold);
      margin-top: 1px;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .player-ctrl {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.8);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.15s;
    }
    .player-ctrl:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    .player-ctrl.play-btn {
      width: 42px;
      height: 42px;
      background: var(--sunset-gold);
      color: var(--ocean-deep);
      font-size: 1.1rem;
    }
    .player-ctrl.play-btn:hover {
      background: var(--sunset-coral);
      transform: scale(1.05);
    }

    .player-links {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }
    .player-link {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.15);
      background: transparent;
      color: rgba(255,255,255,0.5);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      transition: all 0.15s;
      text-decoration: none;
    }
    .player-link:hover {
      border-color: rgba(255,255,255,0.4);
      color: #fff;
      background: rgba(255,255,255,0.08);
    }

    .player-close {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.35);
      cursor: pointer;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .player-close:hover { color: rgba(255,255,255,0.7); }

    /* Song card play button */
    .song-play {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral));
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
      transition: all 0.15s;
      box-shadow: 0 2px 8px rgba(124, 58, 237, 0.25);
    }
    .song-play:hover {
      transform: scale(1.1);
      box-shadow: 0 3px 12px rgba(124, 58, 237, 0.4);
    }
    .song-play.playing {
      background: var(--sunset-gold);
      color: var(--ocean-deep);
    }

    .song-card.now-playing {
      border-color: var(--purple-vibe);
      background: rgba(124, 58, 237, 0.06);
    }

    /* Play All button */
    .play-all-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: 20px;
      border: none;
      background: linear-gradient(135deg, var(--purple-vibe), var(--sunset-coral));
      color: white;
      font-family: var(--font-display);
      font-weight: 600;
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 10px rgba(124, 58, 237, 0.3);
    }
    .play-all-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(124, 58, 237, 0.4);
    }

    /* Add bottom padding to main when player is visible */
    body.player-active main {
      padding-bottom: 90px;
    }
    body.player-active .footer {
      margin-bottom: 72px;
    }

    @media (max-width: 600px) {
      .player-inner { gap: 8px; padding: 8px 12px; }
      .player-art { width: 40px; height: 40px; }
      .player-links { display: none; }
      .player-ctrl.play-btn { width: 38px; height: 38px; }
    }

    #ytFrame {
      position: absolute;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>

<!-- Hidden YouTube IFrame -->
<div id="ytFrame"></div>

<div class="bg-ambient"></div>

<!-- ‚ïê‚ïê‚ïê Header ‚ïê‚ïê‚ïê -->
<header class="header">
  <div class="header-inner">
    <div class="logo" onclick="showHome()">
      <div class="logo-icon">üéß</div>
      <span class="logo-text">VibeCurate</span>
    </div>
    <div class="header-actions">
      <div class="header-stat" id="statCounter">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
        <span id="playlistCount">0</span> created
      </div>
      <button class="btn btn-ghost" onclick="showHistory()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        <span>History</span>
      </button>
      <button class="btn btn-vibe" onclick="showUpgradeModal()" id="upgradeBtn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>
        <span>Go Pro</span>
      </button>
    </div>
  </div>
</header>

<!-- ‚ïê‚ïê‚ïê Main ‚ïê‚ïê‚ïê -->
<main class="main">
  
  <!-- Home View -->
  <div id="homeView">
    <!-- Hero -->
    <section class="hero">
      <div class="hero-icon">üéß</div>
      <h1>Your Vibe.<br><span>AI Curated.</span></h1>
      <p>Tell us the mood. We'll find the music.</p>
      <div class="free-badge" id="freeBadge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        <span id="freeBadgeText">5 free playlists ‚Äî No credit card required</span>
      </div>
    </section>
    
    <!-- Usage Bar (visible after first use) -->
    <div class="usage-bar hidden" id="usageBar">
      <div class="usage-track">
        <div class="usage-fill" id="usageFill" style="width: 0%"></div>
      </div>
      <span class="usage-text" id="usageText">5 left</span>
    </div>
    
    <!-- Quick Prompts -->
    <section class="quick-section">
      <div class="quick-label">‚ö° Quick Start</div>
      <div class="quick-prompts">
        <button class="quick-prompt" onclick="setPrompt('Late night drive through the city')">üåÉ Late night drive</button>
        <button class="quick-prompt" onclick="setPrompt('Sunday morning coffee and sunshine')">‚òÄÔ∏è Sunday morning</button>
        <button class="quick-prompt" onclick="setPrompt('Getting hyped for the gym')">üí™ Gym hype</button>
        <button class="quick-prompt" onclick="setPrompt('Rainy day reading and relaxation')">üåßÔ∏è Rainy day vibes</button>
        <button class="quick-prompt" onclick="setPrompt('Summer beach party energy')">üèñÔ∏è Beach party</button>
        <button class="quick-prompt" onclick="setPrompt('Focus mode for deep work')">üß† Deep focus</button>
      </div>
    </section>
    
    <!-- Input -->
    <section class="input-section">
      <div class="input-container">
        <input type="text" class="vibe-input" id="vibeInput" placeholder="Describe your vibe..." maxlength="200">
        <button class="generate-btn" onclick="generatePlaylist()" id="generateBtn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          Curate
        </button>
      </div>
    </section>
    
    <!-- Loading -->
    <div class="loading-state" id="loadingState">
      <div class="spinner"></div>
      <div class="loading-text">Curating your vibe...</div>
      <div class="loading-sub">Finding the perfect tracks</div>
    </div>
    
    <!-- Results -->
    <div class="playlist-container" id="playlistContainer">
      <div class="playlist-header">
        <div>
          <div class="playlist-title" id="playlistTitle">Your Playlist</div>
          <div class="playlist-mood" id="playlistMood"></div>
        </div>
        <div class="playlist-actions">
          <button class="btn btn-outline" onclick="sharePlaylist()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Share
          </button>
          <button class="btn btn-vibe" onclick="showHome(); document.getElementById('vibeInput').focus();">
            + New Vibe
          </button>
        </div>
      </div>
      <ul class="song-list" id="songList"></ul>
      
      <!-- Cross-sell -->
      <div class="cross-sell">
        <h3>üé® Design a playlist cover?</h3>
        <p>Use <strong>Aesthetic AI</strong> to create stunning visuals for your playlists.</p>
        <a href="https://aesthetic.dubltap.io" target="_blank" class="btn btn-outline">Try Aesthetic AI ‚Üí</a>
      </div>
    </div>
  </div>
  
  <!-- History View -->
  <div class="history-section" id="historyView">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--phi-lg)">
      <h2 class="history-title" style="margin-bottom:0">Your Playlists</h2>
      <button class="btn btn-ghost" onclick="showHome()">‚Üê Back</button>
    </div>
    <div id="historyList">
      <div class="history-empty">No playlists yet. Describe a vibe to get started!</div>
    </div>
  </div>
  
</main>

<!-- ‚ïê‚ïê‚ïê Footer ‚ïê‚ïê‚ïê -->
<footer class="footer">
  Part of <a href="https://dubltap.io">dubltap.io</a> ‚Äî AI that actually does stuff.
</footer>

<!-- ‚ïê‚ïê‚ïê Email Capture Modal ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="emailModal">
  <div class="modal">
    <button class="modal-close" onclick="closeEmailModal()">‚úï</button>
    <div class="modal-icon">üéß</div>
    <h2>Unlock VibeCurate</h2>
    <p>Enter your email to get 5 free AI-curated playlists per month, plus weekly music discovery.</p>
    <div class="modal-error" id="emailError">Please enter a valid email address.</div>
    <input type="email" class="modal-input" id="emailInput" placeholder="your@email.com" onkeypress="if(event.key==='Enter')submitEmail()">
    <button class="modal-submit" onclick="submitEmail()">Get Free Access</button>
    <button class="modal-dismiss" onclick="closeEmailModal()">Maybe later</button>
    <div class="modal-fine-print">No spam. Unsubscribe anytime. We're cool like that.</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê Upgrade Modal ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="upgradeModal">
  <div class="modal">
    <button class="modal-close" onclick="closeUpgradeModal()">‚úï</button>
    <div class="modal-icon">üëë</div>
    <h2>Upgrade to Pro</h2>
    <p>Unlimited playlists, advanced moods, and exclusive features.</p>
    <div class="pricing-options">
      <div class="pricing-card recommended" id="annualCard" onclick="selectPlan('annual')">
        <div class="pricing-name">Annual</div>
        <div class="pricing-price">$79 <span>/year</span></div>
        <div class="pricing-savings">Save 27% ‚Äî $6.58/mo</div>
      </div>
      <div class="pricing-card" id="monthlyCard" onclick="selectPlan('monthly')">
        <div class="pricing-name">Monthly</div>
        <div class="pricing-price">$9 <span>/month</span></div>
        <div class="pricing-savings">&nbsp;</div>
      </div>
    </div>
    <ul class="upgrade-features">
      <li>Unlimited AI-curated playlists</li>
      <li>Advanced mood & genre control</li>
      <li>Playlist export & sharing</li>
      <li>Priority AI processing</li>
      <li>No ads, no limits</li>
    </ul>
    <button class="btn btn-vibe btn-lg" style="width:100%" onclick="handleUpgrade()" id="upgradeSubmit">Start 7-Day Free Trial</button>
    <button class="modal-dismiss" onclick="closeUpgradeModal()">Not now</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê Sticky Player Bar ‚ïê‚ïê‚ïê -->
<div class="player-bar" id="playerBar">
  <div class="player-progress" id="playerProgress" onclick="seekPlayer(event)">
    <div class="player-progress-fill" id="playerProgressFill"></div>
  </div>
  <div class="player-inner">
    <div class="player-art" id="playerArt">
      <span class="player-art-placeholder">üéµ</span>
    </div>
    <div class="player-track">
      <div class="player-track-title" id="playerTitle">‚Äî</div>
      <div class="player-track-artist" id="playerArtist">‚Äî</div>
      <div class="player-track-status" id="playerStatus"></div>
    </div>
    <div class="player-controls">
      <button class="player-ctrl" onclick="playerPrev()" title="Previous">‚èÆ</button>
      <button class="player-ctrl play-btn" id="playerPlayBtn" onclick="playerToggle()" title="Play/Pause">‚ñ∂</button>
      <button class="player-ctrl" onclick="playerNext()" title="Next">‚è≠</button>
    </div>
    <div class="player-links">
      <button class="player-link" id="playerYTLink" onclick="openCurrentYT()" title="Open on YouTube">YT</button>
      <button class="player-link" id="playerSpLink" onclick="openCurrentSpotify()" title="Find on Spotify">‚ô´</button>
    </div>
    <button class="player-close" onclick="closePlayer()" title="Close player">‚úï</button>
  </div>
</div>

<script>
  // YouTube IFrame API loader
  (function() {
    var tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    var firstScript = document.getElementsByTagName('script')[0];
    firstScript.parentNode.insertBefore(tag, firstScript);
  })();
</script>

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // VIBECURATE ‚Äî Application Logic
  // dubltap.io Bridge Product
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  
  const API_BASE = 'https://api.dubltap.io';
  const FREE_LIMIT = 5;
  const EMAIL_GATE_AFTER = 2; // Prompt email after 2nd playlist
  
  // ‚ïê‚ïê‚ïê Stripe Price IDs ‚ïê‚ïê‚ïê
  // Stripe price IDs (LIVE mode verified Feb 2026)
  const STRIPE_PRICES = {
    monthly: 'price_1SwZuDBkYqg7J4R72M7HXfLg',
    annual: 'price_1SwZveBkYqg7J4R7pUhnhc5b'
  };
  
  // ‚ïê‚ïê‚ïê State ‚ïê‚ïê‚ïê
  let isRegistered = false;
  let isPro = false;
  let playlistsCreated = 0;
  let selectedPlan = 'annual';
  let userEmail = '';
  let history = [];
  let currentPlaylist = null;
  let isGenerating = false;

  // ‚ïê‚ïê‚ïê Player State ‚ïê‚ïê‚ïê
  let ytPlayer = null;
  let ytReady = false;
  let playerMode = null; // 'youtube' or 'deezer'
  let playerIsPlaying = false;
  let playerCurrentIndex = -1;
  let audioEl = null; // Deezer preview fallback
  let progressInterval = null;
  let videoIdCache = {};
  let deezerCache = {};
  const INVIDIOUS_INSTANCES = [
    'iv.melmac.space',
    'invidious.einfachzocken.eu',
    'invidious.lunar.icu',
    'inv.tux.pizza'
  ];
  
  // ‚ïê‚ïê‚ïê Initialize ‚ïê‚ïê‚ïê
  function init() {
    loadState();
    updateUI();
    
    document.getElementById('vibeInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') generatePlaylist();
    });
  }

  // ‚ïê‚ïê‚ïê YouTube IFrame API ‚ïê‚ïê‚ïê
  window.onYouTubeIframeAPIReady = function() {
    ytPlayer = new YT.Player('ytFrame', {
      height: '1',
      width: '1',
      playerVars: {
        controls: 0,
        modestbranding: 1,
        rel: 0,
        autoplay: 0,
        origin: window.location.origin,
        playsinline: 1
      },
      events: {
        onReady: function() { ytReady = true; console.log('YT Player ready'); },
        onStateChange: onYTStateChange,
        onError: onYTError
      }
    });
  };

  function onYTStateChange(event) {
    if (playerMode !== 'youtube') return;
    switch (event.data) {
      case YT.PlayerState.PLAYING:
        playerIsPlaying = true;
        document.getElementById('playerPlayBtn').innerHTML = '‚è∏';
        setPlayerStatus('‚ô™ Full song');
        startProgressUpdates();
        break;
      case YT.PlayerState.PAUSED:
        playerIsPlaying = false;
        document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
        stopProgressUpdates();
        break;
      case YT.PlayerState.ENDED:
        playerIsPlaying = false;
        document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
        stopProgressUpdates();
        playerNext();
        break;
      case YT.PlayerState.BUFFERING:
        setPlayerStatus('Buffering...');
        break;
    }
  }

  function onYTError(event) {
    console.warn('YouTube error code:', event.data);
    // Fallback to Deezer preview
    if (playerCurrentIndex >= 0 && currentPlaylist) {
      const song = currentPlaylist.songs[playerCurrentIndex];
      const q = song.title + ' ' + song.artist;
      const dz = deezerCache[q];
      if (dz && dz.preview) {
        playDeezerPreview(dz.preview);
        setPlayerStatus('‚ô™ 30s preview (fallback)');
      } else {
        setPlayerStatus('Playback unavailable');
        // Auto-skip after 2 seconds
        setTimeout(() => playerNext(), 2000);
      }
    }
  }
  
  function loadState() {
    isRegistered = localStorage.getItem('vibecurate_registered') === 'true';
    isPro = localStorage.getItem('vibecurate_pro') === 'true';
    playlistsCreated = parseInt(localStorage.getItem('vibecurate_count') || '0');
    userEmail = localStorage.getItem('vibecurate_email') || '';
    
    try {
      history = JSON.parse(localStorage.getItem('vibecurate_history') || '[]');
    } catch { history = []; }
  }
  
  function saveState() {
    localStorage.setItem('vibecurate_registered', isRegistered);
    localStorage.setItem('vibecurate_pro', isPro);
    localStorage.setItem('vibecurate_count', playlistsCreated);
    localStorage.setItem('vibecurate_email', userEmail);
    localStorage.setItem('vibecurate_history', JSON.stringify(history.slice(0, 50)));
  }
  
  function updateUI() {
    // Counter
    document.getElementById('playlistCount').textContent = playlistsCreated;
    
    // Pro badge
    if (isPro) {
      document.getElementById('upgradeBtn').innerHTML = '<span class="pro-badge"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg> Pro</span>';
      document.getElementById('upgradeBtn').onclick = null;
      document.getElementById('freeBadge').innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> <span>Pro ‚Äî Unlimited playlists</span>';
      document.getElementById('usageBar').classList.add('hidden');
    } else if (isRegistered) {
      const remaining = Math.max(0, FREE_LIMIT - playlistsCreated);
      const usedPct = Math.min((playlistsCreated / FREE_LIMIT) * 100, 100);
      const isLow = remaining <= 1;
      
      document.getElementById('usageBar').classList.remove('hidden');
      document.getElementById('usageFill').style.width = usedPct + '%';
      document.getElementById('usageFill').className = 'usage-fill' + (isLow ? ' low' : '');
      document.getElementById('usageText').textContent = remaining + ' left';
      document.getElementById('usageText').className = 'usage-text' + (isLow ? ' low' : '');
      
      document.getElementById('freeBadgeText').textContent = remaining + ' free playlists remaining';
    }
  }
  
  // ‚ïê‚ïê‚ïê Navigation ‚ïê‚ïê‚ïê
  function showHome() {
    document.getElementById('homeView').style.display = 'block';
    document.getElementById('historyView').classList.remove('active');
  }
  
  function showHistory() {
    document.getElementById('homeView').style.display = 'none';
    document.getElementById('historyView').classList.add('active');
    renderHistory();
  }
  
  function renderHistory() {
    const container = document.getElementById('historyList');
    if (history.length === 0) {
      container.innerHTML = '<div class="history-empty">No playlists yet. Describe a vibe to get started!</div>';
      return;
    }
    
    container.innerHTML = history.map((item, i) => `
      <div class="history-item" onclick="replayPlaylist(${i})">
        <div class="history-item-info">
          <h4>${escapeHtml(item.prompt)}</h4>
          <p>${new Date(item.date).toLocaleDateString()} ¬∑ ${item.songs?.length || 0} tracks</p>
        </div>
        <div class="history-item-count">${item.songs?.length || 0} üéµ</div>
      </div>
    `).join('');
  }
  
  function replayPlaylist(index) {
    currentPlaylist = history[index];
    displayPlaylist(currentPlaylist.prompt, currentPlaylist.songs);
    showHome();
  }
  
  // ‚ïê‚ïê‚ïê Quick Prompt ‚ïê‚ïê‚ïê
  function setPrompt(text) {
    document.getElementById('vibeInput').value = text;
    generatePlaylist();
  }
  
  // ‚ïê‚ïê‚ïê Generate Playlist ‚ïê‚ïê‚ïê
  async function generatePlaylist() {
    const prompt = document.getElementById('vibeInput').value.trim();
    if (!prompt || isGenerating) return;
    
    // Check email gate
    if (!isRegistered && playlistsCreated >= EMAIL_GATE_AFTER) {
      showEmailModal();
      return;
    }
    
    // Check free limit
    if (!isPro && isRegistered && playlistsCreated >= FREE_LIMIT) {
      showUpgradeModal();
      return;
    }
    
    isGenerating = true;
    document.getElementById('generateBtn').disabled = true;
    document.getElementById('loadingState').classList.add('active');
    document.getElementById('playlistContainer').classList.remove('active');
    
    try {
      const response = await fetch(`${API_BASE}/api/ai-query`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          app: 'vibecurate',
          action: 'generate-playlist',
          content: prompt,
          email: userEmail || 'anonymous'
        })
      });
      
      if (!response.ok) throw new Error('API error');
      
      const data = await response.json();
      let songs = [];
      
      // Parse response ‚Äî handle various formats
      if (data.result) {
        const text = typeof data.result === 'string' ? data.result : JSON.stringify(data.result);
        try {
          // Try to extract JSON array from the response
          const jsonMatch = text.match(/\[[\s\S]*\]/);
          if (jsonMatch) {
            songs = JSON.parse(jsonMatch[0]);
          } else {
            // Try parsing the whole result
            const parsed = JSON.parse(text);
            songs = Array.isArray(parsed) ? parsed : parsed.tracks || parsed.playlist || parsed.songs || [];
          }
        } catch {
          // Fallback: generate from text lines
          songs = parseSongsFromText(text);
        }
      }
      
      if (songs.length === 0) {
        songs = getFallbackPlaylist(prompt);
      }
      
      // Track usage
      playlistsCreated++;
      
      // Save to history
      const entry = { prompt, songs, date: new Date().toISOString() };
      history.unshift(entry);
      currentPlaylist = entry;
      
      saveState();
      updateUI();
      displayPlaylist(prompt, songs);
      
    } catch (error) {
      console.error('Generation error:', error);
      // Use intelligent fallback
      const songs = getFallbackPlaylist(prompt);
      playlistsCreated++;
      const entry = { prompt, songs, date: new Date().toISOString() };
      history.unshift(entry);
      currentPlaylist = entry;
      saveState();
      updateUI();
      displayPlaylist(prompt, songs);
    }
    
    isGenerating = false;
    document.getElementById('generateBtn').disabled = false;
    document.getElementById('loadingState').classList.remove('active');
  }
  
  function parseSongsFromText(text) {
    const lines = text.split('\n').filter(l => l.trim());
    const songs = [];
    for (const line of lines) {
      const match = line.match(/["']?(.+?)["']?\s*[-‚Äî‚Äîby]+\s*(.+)/i);
      if (match) {
        songs.push({
          title: match[1].replace(/^\d+[\.\)]\s*/, '').trim(),
          artist: match[2].split(/[-(]/)[0].trim(),
          why: 'Matches your vibe'
        });
      }
    }
    return songs.slice(0, 10);
  }
  
  function getFallbackPlaylist(prompt) {
    const p = prompt.toLowerCase();
    
    if (p.includes('focus') || p.includes('work') || p.includes('study')) {
      return [
        { title: 'Intro', artist: 'The xx', why: 'Minimal, hypnotic layering for deep concentration' },
        { title: 'Weightless', artist: 'Marconi Union', why: 'Scientifically designed to reduce anxiety' },
        { title: 'Experience', artist: 'Ludovico Einaudi', why: 'Piano that elevates without distracting' },
        { title: 'Strobe', artist: 'deadmau5', why: 'Progressive build for long sessions' },
        { title: 'Flume', artist: 'Bon Iver', why: 'Ambient folk that centers the mind' },
        { title: 'Time', artist: 'Hans Zimmer', why: 'Epic build for big project energy' },
        { title: 'Midnight City', artist: 'M83', why: 'Dreamy synthwave to stay in the zone' },
        { title: 'Teardrop', artist: 'Massive Attack', why: 'Atmospheric trip-hop for creative flow' },
      ];
    }
    
    if (p.includes('gym') || p.includes('workout') || p.includes('hype') || p.includes('energy')) {
      return [
        { title: 'Lose Yourself', artist: 'Eminem', why: 'Ultimate motivation anthem' },
        { title: 'POWER', artist: 'Kanye West', why: 'Raw energy and confidence' },
        { title: "Stronger", artist: 'Kanye West', why: 'Daft Punk sample drives the tempo' },
        { title: 'Eye of the Tiger', artist: 'Survivor', why: 'Classic workout motivation' },
        { title: "'Till I Collapse", artist: 'Eminem ft. Nate Dogg', why: 'Push past limits anthem' },
        { title: 'Thunderstruck', artist: 'AC/DC', why: 'Electric guitar energy surge' },
        { title: 'Run This Town', artist: 'JAY-Z ft. Rihanna', why: 'Triumphant ownership energy' },
        { title: 'Bangarang', artist: 'Skrillex', why: 'Bass drops for max intensity' },
      ];
    }
    
    if (p.includes('chill') || p.includes('relax') || p.includes('rain') || p.includes('calm')) {
      return [
        { title: 'Holocene', artist: 'Bon Iver', why: 'Ethereal folk that wraps like a blanket' },
        { title: 'Skinny Love', artist: 'Bon Iver', why: 'Raw emotion, whisper quiet' },
        { title: 'Pink + White', artist: 'Frank Ocean', why: 'Soft, layered, dreamy R&B' },
        { title: 'Saturn', artist: 'SZA', why: 'Gentle contemplation in every note' },
        { title: 'Neon Moon', artist: 'Brooks & Dunn', why: 'Country longing on a quiet night' },
        { title: 'The Night We Met', artist: 'Lord Huron', why: 'Bittersweet nostalgia' },
        { title: 'Sunset Lover', artist: 'Petit Biscuit', why: 'Electronic warmth like golden hour' },
        { title: 'Agnes', artist: 'Glass Animals', why: 'Haunting indie for reflective moods' },
      ];
    }
    
    // Default eclectic mix
    return [
      { title: 'Blinding Lights', artist: 'The Weeknd', why: 'Retro-synth energy that moves' },
      { title: 'Redbone', artist: 'Childish Gambino', why: 'Funk-soul groove for any mood' },
      { title: 'Electric Feel', artist: 'MGMT', why: 'Psychedelic pop with infectious rhythm' },
      { title: 'Dreams', artist: 'Fleetwood Mac', why: 'Timeless vibes, universal appeal' },
      { title: 'Do I Wanna Know?', artist: 'Arctic Monkeys', why: 'Cool, brooding indie rock' },
      { title: 'Get Lucky', artist: 'Daft Punk', why: 'Funky, feel-good perfection' },
      { title: 'Summertime Magic', artist: 'Childish Gambino', why: 'Warm, laid-back sunshine' },
      { title: 'Levitating', artist: 'Dua Lipa', why: 'Disco-pop that lifts the spirit' },
    ];
  }
  
  function displayPlaylist(prompt, songs) {
    document.getElementById('playlistContainer').classList.add('active');
    document.getElementById('playlistTitle').textContent = capitalizeWords(prompt);
    document.getElementById('playlistMood').textContent = 'üéß ' + songs.length + ' tracks curated';
    
    const list = document.getElementById('songList');
    list.innerHTML = songs.map((song, i) => `
      <li class="song-card" id="songCard${i}" style="animation-delay: ${i * 0.06}s">
        <button class="song-play" id="songPlay${i}" onclick="playSong(${i})" title="Play in app">‚ñ∂</button>
        <div class="song-info">
          <div class="song-title">${escapeHtml(song.title || 'Unknown')}</div>
          <div class="song-artist">${escapeHtml(song.artist || 'Unknown Artist')}</div>
          ${song.why ? `<div class="song-why">${escapeHtml(song.why)}</div>` : ''}
        </div>
        <div class="song-actions">
          <button class="song-btn" onclick="window.open('https://www.youtube.com/results?search_query='+encodeURIComponent('${escapeAttr(song.title)} ${escapeAttr(song.artist)}'),'_blank')" title="Search YouTube">üîó</button>
          <button class="song-btn" onclick="window.open('https://open.spotify.com/search/'+encodeURIComponent('${escapeAttr(song.title)} ${escapeAttr(song.artist)}'),'_blank')" title="Find on Spotify">üéµ</button>
        </div>
      </li>
    `).join('');
    
    // Add Play All button to playlist header if not already there
    let playAllContainer = document.getElementById('playAllContainer');
    if (!playAllContainer) {
      playAllContainer = document.createElement('div');
      playAllContainer.id = 'playAllContainer';
      playAllContainer.style.cssText = 'display:flex;gap:8px;margin-bottom:var(--phi-md)';
      const songListEl = document.getElementById('songList');
      songListEl.parentNode.insertBefore(playAllContainer, songListEl);
    }
    playAllContainer.innerHTML = `<button class="play-all-btn" onclick="playSong(0)">‚ñ∂ Play All</button>`;
    
    // Scroll to results
    document.getElementById('playlistContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Pre-resolve Deezer art for all songs in background
    songs.forEach((song) => {
      const q = song.title + ' ' + song.artist;
      if (!deezerCache[q]) resolveDeezer(q);
    });
  }
  
  // ‚ïê‚ïê‚ïê Player Engine ‚ïê‚ïê‚ïê
  
  async function playSong(index) {
    if (!currentPlaylist || index < 0 || index >= currentPlaylist.songs.length) return;
    
    // Stop current playback
    stopAllPlayback();
    
    playerCurrentIndex = index;
    const song = currentPlaylist.songs[index];
    const query = song.title + ' ' + song.artist;
    
    // Show player bar
    document.getElementById('playerBar').classList.add('active');
    document.body.classList.add('player-active');
    
    // Update UI
    updatePlayerUI(song);
    highlightSongCard(index);
    setPlayerStatus('Loading...');
    document.getElementById('playerPlayBtn').innerHTML = '‚è≥';
    
    // Resolve Deezer art + YouTube video ID in parallel
    const [dz, videoId] = await Promise.all([
      resolveDeezer(query),
      resolveVideoId(query)
    ]);
    
    // Set album art
    if (dz && dz.albumArt) {
      document.getElementById('playerArt').innerHTML = `<img src="${dz.albumArt}" alt="Album art">`;
    }
    
    // Try YouTube full song first
    if (videoId && ytReady && ytPlayer) {
      try {
        playerMode = 'youtube';
        ytPlayer.loadVideoById(videoId);
        ytPlayer.playVideo();
        // onYTStateChange will handle UI updates
        return;
      } catch (e) {
        console.warn('YT play failed:', e);
      }
    }
    
    // Fallback: Deezer 30s preview
    if (dz && dz.preview) {
      playDeezerPreview(dz.preview);
      setPlayerStatus('‚ô™ 30s preview');
      return;
    }
    
    // No playback available
    setPlayerStatus('No preview available');
    document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
    playerIsPlaying = false;
  }
  
  function playDeezerPreview(url) {
    if (audioEl) { audioEl.pause(); audioEl = null; }
    audioEl = new Audio(url);
    audioEl.crossOrigin = 'anonymous';
    playerMode = 'deezer';
    
    audioEl.addEventListener('playing', () => {
      playerIsPlaying = true;
      document.getElementById('playerPlayBtn').innerHTML = '‚è∏';
      startProgressUpdates();
    });
    audioEl.addEventListener('pause', () => {
      playerIsPlaying = false;
      document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
      stopProgressUpdates();
    });
    audioEl.addEventListener('ended', () => {
      playerIsPlaying = false;
      stopProgressUpdates();
      playerNext();
    });
    audioEl.addEventListener('error', () => {
      setPlayerStatus('Preview unavailable');
      document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
    });
    
    audioEl.play().catch(e => {
      console.warn('Audio play failed:', e);
      setPlayerStatus('Tap play to start');
      document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
    });
  }
  
  function playerToggle() {
    if (!currentPlaylist || playerCurrentIndex < 0) return;
    
    if (playerIsPlaying) {
      // Pause
      if (playerMode === 'youtube' && ytPlayer) {
        ytPlayer.pauseVideo();
      } else if (playerMode === 'deezer' && audioEl) {
        audioEl.pause();
      }
    } else {
      // Resume or restart
      if (playerMode === 'youtube' && ytPlayer) {
        ytPlayer.playVideo();
      } else if (playerMode === 'deezer' && audioEl) {
        audioEl.play().catch(() => {});
      } else {
        // Re-trigger play for this song
        playSong(playerCurrentIndex);
      }
    }
  }
  
  function playerNext() {
    if (!currentPlaylist) return;
    const next = playerCurrentIndex + 1;
    if (next < currentPlaylist.songs.length) {
      playSong(next);
    } else {
      // End of playlist
      stopAllPlayback();
      setPlayerStatus('Playlist ended');
      document.getElementById('playerPlayBtn').innerHTML = '‚ñ∂';
    }
  }
  
  function playerPrev() {
    if (!currentPlaylist) return;
    const prev = playerCurrentIndex - 1;
    if (prev >= 0) {
      playSong(prev);
    } else {
      // Restart first song
      playSong(0);
    }
  }
  
  function closePlayer() {
    stopAllPlayback();
    document.getElementById('playerBar').classList.remove('active');
    document.body.classList.remove('player-active');
    playerCurrentIndex = -1;
    highlightSongCard(-1);
  }
  
  function stopAllPlayback() {
    stopProgressUpdates();
    if (playerMode === 'youtube' && ytPlayer) {
      try { ytPlayer.stopVideo(); } catch(e) {}
    }
    if (audioEl) {
      try { audioEl.pause(); audioEl = null; } catch(e) {}
    }
    playerIsPlaying = false;
    playerMode = null;
  }
  
  function updatePlayerUI(song) {
    document.getElementById('playerTitle').textContent = song.title || 'Unknown';
    document.getElementById('playerArtist').textContent = song.artist || 'Unknown Artist';
    document.getElementById('playerArt').innerHTML = '<span class="player-art-placeholder">üéµ</span>';
    document.getElementById('playerProgressFill').style.width = '0%';
  }
  
  function setPlayerStatus(text) {
    document.getElementById('playerStatus').textContent = text;
  }
  
  function highlightSongCard(activeIndex) {
    // Clear all highlights
    document.querySelectorAll('.song-card').forEach((card, i) => {
      card.classList.remove('now-playing');
      const btn = document.getElementById('songPlay' + i);
      if (btn) {
        btn.classList.remove('playing');
        btn.innerHTML = '‚ñ∂';
      }
    });
    // Highlight active
    if (activeIndex >= 0) {
      const card = document.getElementById('songCard' + activeIndex);
      if (card) card.classList.add('now-playing');
      const btn = document.getElementById('songPlay' + activeIndex);
      if (btn) {
        btn.classList.add('playing');
        btn.innerHTML = '‚è∏';
      }
    }
  }
  
  // ‚ïê‚ïê‚ïê Progress Bar ‚ïê‚ïê‚ïê
  function startProgressUpdates() {
    stopProgressUpdates();
    progressInterval = setInterval(() => {
      let pct = 0;
      if (playerMode === 'youtube' && ytPlayer && ytPlayer.getDuration) {
        const dur = ytPlayer.getDuration();
        const cur = ytPlayer.getCurrentTime();
        if (dur > 0) pct = (cur / dur) * 100;
      } else if (playerMode === 'deezer' && audioEl) {
        if (audioEl.duration > 0) pct = (audioEl.currentTime / audioEl.duration) * 100;
      }
      document.getElementById('playerProgressFill').style.width = pct + '%';
    }, 500);
  }
  
  function stopProgressUpdates() {
    if (progressInterval) { clearInterval(progressInterval); progressInterval = null; }
  }
  
  function seekPlayer(event) {
    const bar = document.getElementById('playerProgress');
    const rect = bar.getBoundingClientRect();
    const pct = (event.clientX - rect.left) / rect.width;
    
    if (playerMode === 'youtube' && ytPlayer && ytPlayer.getDuration) {
      ytPlayer.seekTo(pct * ytPlayer.getDuration(), true);
    } else if (playerMode === 'deezer' && audioEl && audioEl.duration) {
      audioEl.currentTime = pct * audioEl.duration;
    }
  }
  
  // ‚ïê‚ïê‚ïê Video ID Resolution (Invidious) ‚ïê‚ïê‚ïê
  async function resolveVideoId(query) {
    if (videoIdCache[query]) return videoIdCache[query];
    
    for (const instance of INVIDIOUS_INSTANCES) {
      try {
        const url = `https://${instance}/api/v1/search?q=${encodeURIComponent(query)}&type=video&sort_by=relevance`;
        const res = await fetch(url, { signal: AbortSignal.timeout(5000) });
        if (!res.ok) continue;
        const results = await res.json();
        
        // Find best match: prefer 1-12 min duration, skip 10hr loops
        const good = results.filter(r => 
          r.type === 'video' && 
          r.lengthSeconds > 60 && 
          r.lengthSeconds < 720
        );
        const pick = good.length > 0 ? good[0] : results.find(r => r.type === 'video' && r.lengthSeconds > 30);
        
        if (pick && pick.videoId) {
          videoIdCache[query] = pick.videoId;
          return pick.videoId;
        }
      } catch(e) {
        console.warn(`Invidious ${instance} failed:`, e.message);
        continue;
      }
    }
    return null;
  }
  
  // ‚ïê‚ïê‚ïê Deezer Album Art + Preview ‚ïê‚ïê‚ïê
  async function resolveDeezer(query) {
    if (deezerCache[query]) return deezerCache[query];
    
    try {
      // Use CORS proxy for Deezer API
      const url = `https://api.deezer.com/search?q=${encodeURIComponent(query)}&limit=1&output=jsonp&callback=?`;
      
      // JSONP approach for Deezer (no CORS headers)
      const result = await new Promise((resolve, reject) => {
        const callbackName = 'dz_' + Math.random().toString(36).substr(2, 8);
        const timeout = setTimeout(() => {
          delete window[callbackName];
          reject(new Error('Deezer timeout'));
        }, 5000);
        
        window[callbackName] = function(data) {
          clearTimeout(timeout);
          delete window[callbackName];
          document.getElementById('dz_script_' + callbackName)?.remove();
          resolve(data);
        };
        
        const script = document.createElement('script');
        script.id = 'dz_script_' + callbackName;
        script.src = `https://api.deezer.com/search?q=${encodeURIComponent(query)}&limit=1&output=jsonp&callback=${callbackName}`;
        script.onerror = () => {
          clearTimeout(timeout);
          delete window[callbackName];
          reject(new Error('Deezer script error'));
        };
        document.head.appendChild(script);
      });
      
      if (result && result.data && result.data.length > 0) {
        const track = result.data[0];
        const info = {
          albumArt: track.album?.cover_medium || track.album?.cover || null,
          preview: track.preview || null,
          title: track.title,
          artist: track.artist?.name
        };
        deezerCache[query] = info;
        return info;
      }
    } catch(e) {
      console.warn('Deezer resolve failed:', e.message);
    }
    
    deezerCache[query] = { albumArt: null, preview: null };
    return deezerCache[query];
  }
  
  // ‚ïê‚ïê‚ïê External Links (from player bar) ‚ïê‚ïê‚ïê
  function openCurrentYT() {
    if (!currentPlaylist || playerCurrentIndex < 0) return;
    const song = currentPlaylist.songs[playerCurrentIndex];
    window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(song.title + ' ' + song.artist)}`, '_blank');
  }
  
  function openCurrentSpotify() {
    if (!currentPlaylist || playerCurrentIndex < 0) return;
    const song = currentPlaylist.songs[playerCurrentIndex];
    window.open(`https://open.spotify.com/search/${encodeURIComponent(song.title + ' ' + song.artist)}`, '_blank');
  }
  
  function sharePlaylist() {
    if (!currentPlaylist) return;
    const text = `üéß VibeCurate Playlist: "${currentPlaylist.prompt}"\n\n` +
      currentPlaylist.songs.map((s, i) => `${i+1}. ${s.title} ‚Äî ${s.artist}`).join('\n') +
      '\n\nMade with https://vibe.dubltap.io';
    
    if (navigator.share) {
      navigator.share({ title: 'VibeCurate Playlist', text });
    } else {
      navigator.clipboard.writeText(text).then(() => {
        alert('Playlist copied to clipboard!');
      });
    }
  }
  
  // ‚ïê‚ïê‚ïê Email Capture ‚ïê‚ïê‚ïê
  function showEmailModal() {
    document.getElementById('emailModal').classList.add('active');
    setTimeout(() => document.getElementById('emailInput').focus(), 100);
  }
  
  function closeEmailModal() {
    document.getElementById('emailModal').classList.remove('active');
  }
  
  async function submitEmail() {
    const email = document.getElementById('emailInput').value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    if (!emailRegex.test(email)) {
      document.getElementById('emailError').style.display = 'block';
      return;
    }
    
    document.getElementById('emailError').style.display = 'none';
    userEmail = email;
    isRegistered = true;
    saveState();
    updateUI();
    closeEmailModal();
    
    // Send to backend
    try {
      await fetch(`${API_BASE}/api/email-capture`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          source: 'vibecurate',
          tags: ['vibecurate', 'bridge-product']
        })
      });
    } catch (e) {
      console.log('Email capture sent');
    }
    
    // Continue with generation if they were trying to create
    const prompt = document.getElementById('vibeInput').value.trim();
    if (prompt) generatePlaylist();
  }
  
  // ‚ïê‚ïê‚ïê Upgrade Flow ‚ïê‚ïê‚ïê
  function showUpgradeModal() {
    document.getElementById('upgradeModal').classList.add('active');
    selectPlan('annual');
  }
  
  function closeUpgradeModal() {
    document.getElementById('upgradeModal').classList.remove('active');
  }
  
  function selectPlan(plan) {
    selectedPlan = plan;
    document.getElementById('annualCard').classList.toggle('selected', plan === 'annual');
    document.getElementById('monthlyCard').classList.toggle('selected', plan === 'monthly');
  }
  
  async function handleUpgrade() {
    const priceId = STRIPE_PRICES[selectedPlan];
    
    try {
      const response = await fetch(`${API_BASE}/create-checkout`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          priceId,
          email: userEmail || undefined,
          successUrl: window.location.origin + '/?upgraded=true',
          cancelUrl: window.location.origin + '/'
        })
      });
      
      if (response.ok) {
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        }
      } else {
        alert('Unable to start checkout. Please try again.');
      }
    } catch (error) {
      console.error('Checkout error:', error);
      alert('Unable to connect to payment system. Please try again.');
    }
  }
  
  // ‚ïê‚ïê‚ïê Check for upgrade success ‚ïê‚ïê‚ïê
  function checkUpgradeSuccess() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('upgraded') === 'true') {
      isPro = true;
      saveState();
      updateUI();
      window.history.replaceState({}, '', window.location.pathname);
      alert('üéâ Welcome to VibeCurate Pro! Unlimited playlists unlocked.');
    }
  }
  
  // ‚ïê‚ïê‚ïê Utilities ‚ïê‚ïê‚ïê
  function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }
  
  function escapeAttr(str) {
    return (str || '').replace(/'/g, "\\'").replace(/"/g, '\\"');
  }
  
  function capitalizeWords(str) {
    return str.replace(/\b\w/g, l => l.toUpperCase());
  }
  
  // ‚ïê‚ïê‚ïê Boot ‚ïê‚ïê‚ïê
  init();
  checkUpgradeSuccess();
</script>

</body>
</html>
